<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Limpiar Cach√© Completo - LA BOVEDA VIP</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            background: #2d2d2d;
            padding: 30px;
            border-radius: 10px;
        }
        button {
            background: #0ea5e9;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #0284c7;
        }
        .success {
            color: #10b981;
            margin: 10px 0;
        }
        .error {
            color: #ef4444;
            margin: 10px 0;
        }
        .info {
            background: #1f2937;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        pre {
            background: #111827;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üßπ Limpiar Cach√© Completo</h1>
        <p>Esta herramienta limpiar√° TODO el cach√© y forzar√° que el sitio use el backend correcto.</p>

        <div class="info">
            <h3>üìã Pasos a seguir:</h3>
            <ol>
                <li>Click en "Limpiar Todo el Cach√©"</li>
                <li>Click en "Verificar Backend"</li>
                <li>Si todo est√° bien, click en "Ir al Sitio"</li>
            </ol>
        </div>

        <button onclick="limpiarTodo()">üßπ Limpiar Todo el Cach√©</button>
        <button onclick="verificarBackend()">üîç Verificar Backend</button>
        <button onclick="irAlSitio()">üöÄ Ir al Sitio</button>

        <div id="resultado"></div>
    </div>

    <script>
        const BACKEND_URL = 'https://la-boveda-vip-production.up.railway.app/api';

        function limpiarTodo() {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML = '<p>üßπ Limpiando...</p>';

            try {
                // Limpiar localStorage
                localStorage.clear();
                console.log('‚úÖ localStorage limpiado');

                // Limpiar sessionStorage
                sessionStorage.clear();
                console.log('‚úÖ sessionStorage limpiado');

                // Limpiar cach√© del navegador (si es posible)
                if ('caches' in window) {
                    caches.keys().then(names => {
                        names.forEach(name => {
                            caches.delete(name);
                        });
                        console.log('‚úÖ Cach√© del navegador limpiado');
                    });
                }

                resultado.innerHTML = `
                    <div class="success">
                        <h3>‚úÖ Cach√© Limpiado</h3>
                        <p>Se limpi√≥:</p>
                        <ul>
                            <li>localStorage</li>
                            <li>sessionStorage</li>
                            <li>Cach√© del navegador</li>
                        </ul>
                        <p><strong>Ahora verifica el backend y luego ve al sitio.</strong></p>
                    </div>
                `;
            } catch (error) {
                resultado.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Error</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function verificarBackend() {
            const resultado = document.getElementById('resultado');
            resultado.innerHTML = '<p>üîç Verificando backend...</p>';

            try {
                // Verificar health
                const healthResponse = await fetch(`${BACKEND_URL}/health`);
                const health = await healthResponse.json();

                // Verificar settings
                const settingsResponse = await fetch(`${BACKEND_URL}/public/settings`);
                const settings = await settingsResponse.json();

                if (settings.siteName === 'LA BOVEDA VIP') {
                    resultado.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ Backend Funcionando Correctamente</h3>
                            <p><strong>Site Name:</strong> ${settings.siteName}</p>
                            <p><strong>Backend URL:</strong> ${BACKEND_URL}</p>
                            <p><strong>Health Status:</strong> ${health.status}</p>
                            <p><strong>‚úÖ Todo est√° configurado correctamente!</strong></p>
                            <p>Ahora puedes ir al sitio y deber√≠a mostrar "LA BOVEDA VIP"</p>
                        </div>
                    `;
                } else {
                    resultado.innerHTML = `
                        <div class="error">
                            <h3>‚ö†Ô∏è Backend tiene datos incorrectos</h3>
                            <p><strong>Site Name actual:</strong> ${settings.siteName}</p>
                            <p>El backend est√° devolviendo datos incorrectos. Necesitas reiniciar el backend en Railway.</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultado.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Error conectando al backend</h3>
                        <p>${error.message}</p>
                        <p><strong>Posibles causas:</strong></p>
                        <ul>
                            <li>El backend no est√° funcionando</li>
                            <li>Problemas de CORS</li>
                            <li>URL incorrecta</li>
                        </ul>
                    </div>
                `;
            }
        }

        function irAlSitio() {
            // Obtener la URL del sitio actual
            const sitioUrl = window.location.origin;
            window.location.href = sitioUrl;
        }

        // Verificar autom√°ticamente al cargar
        window.addEventListener('load', () => {
            console.log('üîç Herramienta de limpieza de cach√© cargada');
            console.log('Backend URL:', BACKEND_URL);
        });
    </script>
</body>
</html>


